# iOS Entitlements and Capabilities Guide

## Current App Configuration

**Bundle Identifier**: `com.tranquilfastcoach.app`
**App Name**: Tranquil Fast Coach
**Build Number**: 1
**Version**: 1.0.0

---

## Required Capabilities

Based on the current app.json configuration and installed packages, the following capabilities are required in the Apple Developer App ID:

### 1. **Push Notifications** ‚úÖ Required
- **Entitlement**: `aps-environment`
- **Plugin Source**: `expo-notifications`
- **Reason**: Sends fasting reminders and milestone notifications
- **Status**: Must be enabled in App ID

### 2. **Background Modes** ‚úÖ Required
- **UIBackgroundModes**: `remote-notification`
- **Plugin Source**: `expo-notifications`, `expo-task-manager`
- **Reason**: Handles background notifications and tasks
- **Status**: Automatically handled by Expo

### 3. **Location Services** ‚úÖ Required
- **Plugin Source**: `expo-location`
- **InfoPlist Keys Added**:
  - `NSLocationWhenInUseUsageDescription`: "We need your location to provide location-based fasting reminders and insights."
- **Status**: Automatically handled by Expo

### 4. **Photo Library & Camera** ‚úÖ Required
- **Plugin Source**: `expo-image-picker`
- **InfoPlist Keys Added**:
  - `NSPhotoLibraryUsageDescription`: "We need access to your photo library to let you choose profile pictures."
  - `NSCameraUsageDescription`: "We need camera access to let you take profile pictures."
- **Status**: Automatically handled by Expo

---

## Removed/Not Required

### ‚ùå Wi-Fi Information Entitlement
- **Previous entitlement**: `com.apple.developer.networking.wifi-info`
- **Status**: **REMOVED** - This was causing the build error
- **Reason**: Not needed for app functionality
- **Issue**: Was incorrectly formatted in app.json causing "doesn't include the com entitlement" error

### ‚ùå Sign in with Apple
- **Entitlement**: `com.apple.developer.applesignin`
- **Status**: Not used in this app
- **Note**: No expo-apple-authentication package installed

### ‚ùå HealthKit
- **Entitlement**: `com.apple.developer.healthkit`
- **Status**: Not used in this app
- **Note**: No HealthKit-related packages installed

### ‚ùå Associated Domains
- **Entitlement**: `com.apple.developer.associated-domains`
- **Status**: Not used in this app
- **Note**: No Branch.io or universal links configured

---

## Apple Developer Portal Setup Checklist

### Prerequisites
- Apple Developer Account with **Admin** or **Account Holder** role
- Access to [Apple Developer Portal](https://developer.apple.com/)

### Step 1: Update App ID Capabilities

1. Navigate to **Certificates, Identifiers & Profiles**
2. Select **Identifiers**
3. Find and select `com.tranquilfastcoach.app`
4. Enable the following capabilities:
   - ‚úÖ **Push Notifications**
   - ‚úÖ **Background Modes** (should already be enabled)
5. Click **Save**

### Step 2: Regenerate Provisioning Profile

The provisioning profile will be automatically regenerated by EAS when you build with `--clear-credentials`. This ensures:
- All required capabilities are included
- No invalid entitlements remain
- Profile is up-to-date with App ID configuration

---

## EAS Build Commands

### Production Build (Recommended)

**Option 1: Simple build (EAS will prompt if credentials need updating)**
```bash
npx eas-cli build --platform ios --profile production --clear-cache
```

**Option 2: Manually configure credentials first (if you need to regenerate provisioning profile)**
```bash
# Step 1: Configure credentials (interactive)
npx eas-cli credentials --platform ios

# Step 2: Build with cleared cache
npx eas-cli build --platform ios --profile production --clear-cache
```

**Flags explained**:
- `--platform ios` or `-p ios`: Build for iOS
- `--profile production`: Use production build configuration (App Store distribution)
- `--clear-cache`: Clear any cached build artifacts

### Submit to TestFlight

After successful build:

```bash
npx eas-cli submit -p ios
```

This will:
1. Prompt you to select the build
2. Automatically upload to App Store Connect
3. Submit for TestFlight processing

**Alternative**: EAS can auto-submit after build:
```bash
npx eas-cli build -p ios --profile production --auto-submit
```

---

## Target Markets

### Primary Markets
- üá∫üá∏ United States
- üá¨üáß United Kingdom

### Secondary Markets
- üá®üá≠ Switzerland
- üá™üá∫ European Union
- üáßüá∑ Brazil

---

## Troubleshooting

### Issue: "Provisioning profile doesn't include the com entitlement"

**Solution**: ‚úÖ Fixed in this PR
- Removed invalid entitlements structure from app.json
- The nested `com.apple.developer.networking.wifi-info` entitlement was incorrectly formatted
- Now using only standard entitlements managed by Expo plugins

### Issue: Build fails with entitlement errors

**Solution**:
1. Ensure you have **Admin/Account Holder** role in Apple Developer
2. Use `--clear-credentials` flag to regenerate provisioning profile
3. Verify App ID capabilities match required entitlements

### Issue: App rejected for missing usage descriptions

**Solution**: ‚úÖ All required usage descriptions added
- NSLocationWhenInUseUsageDescription
- NSUserNotificationsUsageDescription
- NSPhotoLibraryUsageDescription
- NSCameraUsageDescription

---

## Package ‚Üí Entitlement Mapping

| Package | Entitlements/Permissions Required | InfoPlist Keys |
|---------|----------------------------------|----------------|
| expo-notifications | Push Notifications, Background Modes | NSUserNotificationsUsageDescription |
| expo-location | Location Services | NSLocationWhenInUseUsageDescription |
| expo-image-picker | Photo Library, Camera | NSPhotoLibraryUsageDescription, NSCameraUsageDescription |
| expo-task-manager | Background Modes | - |

---

## Build Configuration Summary

### app.json Changes
- ‚úÖ Removed invalid entitlements structure
- ‚úÖ Added `buildNumber: "1"`
- ‚úÖ Changed UIBackgroundModes from `background-processing` to `remote-notification`
- ‚úÖ Added all required InfoPlist usage descriptions

### eas.json Changes
- ‚úÖ Added `ios.distribution: "store"` to production profile
- ‚úÖ Kept `autoIncrement: true` for automatic build number bumping

---

## Next Steps After PR Merge

1. **Pull latest changes** from main/chore/ui-ux-audit branch
2. **Run the production build** command above
3. **Monitor EAS build** at https://expo.dev/accounts/[your-account]/projects/tranquil-fast-coach
4. **Wait for build completion** (~15-20 minutes)
5. **Submit to TestFlight** using the submit command above
6. **Test on TestFlight** before releasing to App Store

---

## Support

For issues with:
- **EAS Build**: Check build logs at expo.dev
- **Apple Developer Portal**: Ensure Admin/Account Holder access
- **Entitlements**: Verify App ID capabilities match this document
- **TestFlight**: Check App Store Connect for processing status
